<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
      
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>SVG Plot Tests</title>

<link href="simple.css" rel="stylesheet" type="text/css"></link>
<link href="interpreter/interpreter.css" rel="stylesheet" type="text/css"></link>

<script type="text/javascript" src="../MochiKit/MochiKit.js"></script>
<!--
<script type="text/javascript" src="interpreter/interpreter.js"></script>
<script type="text/javascript" src="interpreter/popup.js"></script>
-->
<script type="text/javascript" src="../MochiKit/SVG.js" ></script>
<script type="text/javascript" src="../MochiKit/SVGCanvas.js"></script>
<script type="text/javascript" src="../MochiKit/SVGPlot.js"></script>

<script type="text/javascript">

var POINT_COUNT = 40;

var intsquares = Array(POINT_COUNT); // squares of their position
for (var i=0; i<POINT_COUNT; i++)
    intsquares[i] = i*i;

var TRIG_XMIN = -2*Math.PI;
var TRIG_XMAX = 2*Math.PI;
var trigx = Array(POINT_COUNT);
var sin = Array(POINT_COUNT);
var cos = Array(POINT_COUNT);
var tan = Array(POINT_COUNT);
var atan = Array(POINT_COUNT);
for (var i=0; i<POINT_COUNT; i++) {
    var x = TRIG_XMIN + (TRIG_XMAX-TRIG_XMIN)*i/(POINT_COUNT-1);
    log("in trig x=" + x);
    trigx[i] = x;
    sin[i] = Math.sin(x);
    cos[i] = Math.cos(x);
    tan[i] = Math.tan(x);
    atan[i] = Math.atan(x);
}


var testFunctions = {
    
    'simpleLine' : function(p) {
        var intsquares = Array(POINT_COUNT); // squares of their position
        for (var i=0; i<POINT_COUNT; i++)
            intsquares[i] = i*i;
        p.plotLine(intsquares)
        p.render()
    },
    
    'xyLine' : function(p) {
        p.plotLine(trigx, sin)
        p.render()
    },
    
    'multiPlot' : function(p) {
        p.plotLine(trigx, sin)
        p.plotLine(trigx, cos)
        p.render()
    },
    
    'styleLine' : function(p) {
        p.strokeStyle = "#00E";
        p.plotLine(trigx, sin);
        p.strokeStyle = "#E00";
        p.plotLine(trigx, cos);
        
        p.strokeStyle = "rgba(100, 0, 100, .5)";
        p.lineWidth = '5' 
        p.dasharray = ".5,1,2";
        p.dashoffset = 2;
        p.plotLine(trigx, atan);
        p.render()
    },
    
    'functionPlot' : function(p) {
        p.plotFunction('Math.atan(x)', 'x', -8, 8);
        p.render()
    },
    
    'trickyFunctionPlot' : function(p) {
        p.plotFunction('Math.sin(1/x)', 'x', -4, 4);
        p.render()
    },
    
    'decorations' : function(p) {
        p.strokeStyle = "#888";
        p.fillStyle = "#888";
        p.addBox();
        p.addBoxDefaults();
        var locations = [-2*Math.PI, -Math.PI, 0, Math.PI, 2*Math.PI]
        p.setXTicks(locations)
        p.setXStubs(locations, ['-2pi', '-pi', '0', 'pi', '2pi'])
        locations = [-1, -0.5, 0, 0.5, 1]
        p.setYTicks(locations)
        p.setYStubs(locations)
        p.fontSize = '10';
        p.fontFamily="Verdana, Arial, Helvetica, Sans"
        p.setXLabel("Time (ns)");
        p.setYLabel("Voltage (V)");
        p.strokeStyle = 'rgba(255, 50, 50, 0.5)';
        p.plotLine(trigx, sin);
        p.strokeStyle = 'rgba(50, 50, 255, 0.5)';
        p.plotLine(trigx, cos);
        p.render();
    },
    
    'ticks' : function(p) {
        p.plotLine(trigx, sin)
        p.setXTicks(trigx)
        p.setYTicks(sin)
        p.removeXStubs()
        p.removeYStubs()
        p.render()
    },
    
    'scales' : function(p) {
        p.plotLine(trigx, sin)
        p.render()
    },
    
    'scalestyles' : function(p) {
        p.fillStyle = "#950";
        p.addBox();
        p.addBoxDefaults();
        p.strokeStyle = "rgba(255,0,0,.5)";
        p.plotFunction("Math.sin(x)", "x", -2 * Math.PI, 2 * Math.PI);
        p.strokeStyle = "rgba(0,0,255,.5)";
        p.plotFunction("Math.cos(x)", "x", -2 * Math.PI, 2 * Math.PI);
        p.render();
    },
    
    'dependentaxes' : function(p) {
        // Temperature
    },
    
    'independentaxes' : function(p) {
        // Population & GDP over time.
    }
};

function doTest(plotTD, functionArea, svgSrcArea) {
    var plot
    plot = new SVGPlot(220, 220);
    var setSVGSrc = function (svg, textarea) {
        replaceChildNodes(textarea, svg.toXML());
    }
    var testFunction = eval(functionArea.value);
    plot.svg.whenReady( partial(testFunction, plot) );
    plot.svg.whenReady( partial(setSVGSrc, plot.svg, svgSrcArea) );
    replaceChildNodes(plotTD, plot.svg.htmlElement);
}

function addTests() {
    log("getting table");
    var table = $('tests');
    var i = 0, start = 0, number = 20;
    var onlyDraw = '';
    for (var test in testFunctions) {
        if (i>=start && i-start<number && onlyDraw==''|| onlyDraw!='' && onlyDraw==test) {
            log("doing test", test);
            var plotSrc = (''+testFunctions[test]+'\n').replace(/ +/g, " ");
            var functionArea, plotSrcArea, button, plotTD, button;
            var tr = TR(null, TD(null, test, BR(null), IMG({'src':test+'.png'}) ), 
                              TD(null, functionArea=TEXTAREA({'rows':"14", 'cols':"40", 'wrap':"off"}, plotSrc),
                                       BR(null),
                                       button=INPUT({'type':"button", 'value':"Do It"}) ),
                              plotTD=TD(null),
                              TD(null, plotSrcArea=TEXTAREA({'rows':"16", 'cols':"60", 'wrap':"off"} ,"SVG Source") )
                        );
            appendChildNodes(table, tr);
            addToCallStack(button, 'onclick', partial(doTest, plotTD, functionArea, plotSrcArea) );
            doTest(plotTD, functionArea, plotSrcArea);
        }
        i++;
    }
}

addLoadEvent(addTests);
</script>

</head>

<body>


<div>

<form  method="post" action="javascript:void()">
<table id="tests" border="1">
<tr>
<td align="center"><strong>Image</strong></td>
<td align="center"><strong>Plot Source</strong></td>
<td align="center"><strong>SVG</strong></td>
<td align="center"><strong>SVG Source</strong></td></tr>
</table>


</body>
</html>
